(function(t){require.config({paths:{d3:"https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min"}});define(["d3"],function(e){return t({},e)})})(function(t,e){e.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})};e.selection.prototype.moveToBack=function(){return this.each(function(){var t=this.parentNode.firstChild;if(t){this.parentNode.insertBefore(this,t)}})};var n={neuron:{colors:{input:"#00A000",hidden:"#0000C7",output:"#F6BD00",bias:"#8F686F"},mouseon:{change_radius:2,alpha:.2}},synapse:{colors:{negative:"#00005E",positive:"#FF4B00"},width_range:[.5,5],alpha:.7,mouseon:{width_range:[.5,10],alpha:.1}},variables:{labels_layer0_padding:.03},legend:{pos:{x:-150,y:10},rect:{width:10,height:10},dy:20,padding:10}};var r,a,i,o;var s=function(t){return Number(Object.keys(i["layout"]["layer_"+t]).length-1)};var l=function(t){var e=s(t);var n=Array(e);for(var a=0;a<e;a++){n[a]={position:{x:(t+.5)*r.width/o,y:(a+.5)*r.height/e},radius:r.height/(e+(e>5?0:5))/4,type:a==e-1?"bias":t==0?"input":"hidden",neuron:a,layer:t};if(t==o-1){n[a]["type"]="output"}}return n};var u=function(t,e){var e=i["layout"]["layer_"+t]["neuron_"+e];if(e["nsynapses"]!=0)return e["weights"];return[]};var c=function(){var t=-1e30;var n=1e30;var r;for(var a=0;a<o;a++){for(var i=0;i<s(a);i++){r=e.max(u(a,i));if(t<r)t=r;r=e.min(u(a,i));if(n>r)n=r}}return{min:n,max:t}};var p=function(t,e,n,r){var a=u(t,e);var i=Array(a.length);for(var o in a){i[o]={layer:t,neuron:e,nextlayer_neuron:o,pos:[n,r[o].position],weight:a[o],type:a[o]<0?"negative":"positive"}}return i};var h=function(t){var e=i["variables"];e.push("Bias node");var a=Array(e.length);for(var o in t){a[o]={x:t[o].position.x-n["variables"]["labels_layer0_padding"]*r.width,y:t[o].position.y,text:e[o]+":"}}return a};var d=function(t){t.append("text").text(function(t){return t[1].text}).attr("x",function(t){return t[1].x-this.getComputedTextLength()}).attr("y",function(t){return t[1].y+.25*this.getBBox().height})};var y=function(t,r,i){if(i!==undefined){var o=e.zip(t,h(t))}else{var o=e.zip(t,Array(t.length))}var s=a.append("g").attr("id","layer_"+r).attr("class","layer").selectAll("g").data(o).enter().append("g").attr("id",function(t){return"neuron_"+r+""+t[0].neuron});s.append("circle").attr("r",function(t){return t[0].radius}).attr("cx",function(t){return t[0].position.x}).attr("cy",function(t){return t[0].position.y}).style("fill",function(t){return n["neuron"]["colors"][t[0].type]});if(i!==undefined){d(s)}m(s)};var f=e.scale.linear().range(n["synapse"]["width_range"]);var g=e.scale.linear().range(n["synapse"]["width_range"]);var v=e.svg.line().x(function(t){return t.x}).y(function(t){return t.y}).interpolate("linear");var x=function(t,e,r){for(var i in t){var o=p(e,i,t[i].position,r);a.select("g#neuron_"+e+""+i).selectAll("path").data(o).enter().append("path").moveToBack().attr("d",function(t){return v(t.pos)}).attr("stroke",function(t){return n["synapse"]["colors"][t.type]}).attr("stroke-width",function(t){return t.type=="positive"?f(t.weight):g(Math.abs(t.weight))}).attr("stroke-opacity",n["synapse"]["alpha"])}};var m=function(t){t.on("mouseover",function(t){f.range(n["synapse"]["mouseon"]["width_range"]);g.range(n["synapse"]["mouseon"]["width_range"]);var r=e.select(this).moveToFront().transition();r.selectAll("path").style("stroke-opacity",1).attr("stroke-width",function(t){return t.type=="positive"?f(t.weight):g(Math.abs(t.weight))});r.selectAll("circle").style("fill-opacity",1).attr("r",function(t){return t[0].radius*n["neuron"]["mouseon"]["change_radius"]});r.selectAll("text").attr("x",function(t){return t[1].x-t[0].radius-this.getComputedTextLength()});var i=a.selectAll("g.layer").selectAll("g").filter(function(e){return!(t[0].neuron==e[0].neuron&&t[0].layer==e[0].layer)}).transition();i.selectAll("circle").filter(function(e){return t[0].layer+1!=e[0].layer}).style("fill-opacity",n["neuron"]["mouseon"]["alpha"]).attr("r",function(t){return t[0].radius});i.selectAll("path").style("stroke-opacity",n["synapse"]["mouseon"]["alpha"]);f.range(n["synapse"]["width_range"]);g.range(n["synapse"]["width_range"])});t.on("mouseout",function(t){var e=a.selectAll("g.layer").selectAll("g").transition();e.selectAll("circle").style("fill-opacity",1).attr("r",function(t){return t[0].radius});e.selectAll("path").style("stroke-opacity",n["synapse"]["alpha"]).attr("stroke-width",function(t){return t.type=="positive"?f(t.weight):g(Math.abs(t.weight))});e.selectAll("text").attr("x",function(t){return t[1].x-this.getComputedTextLength()})})};var w=function(){var t=[{c:n["synapse"]["colors"]["positive"],txt:"Positive weight"},{c:n["synapse"]["colors"]["negative"],txt:"Negative weight"}];var r=n["legend"];var i=a.append("g").attr("id","legend");i.selectAll("g").data(t).enter().append("g").each(function(t,n){var a=e.select(this);a.append("rect").attr("x",r.pos.x).attr("y",r.pos.y+n*r.dy).attr("width",r.rect.width).attr("height",r.rect.height).style("fill",function(t){return t.c});a.append("text").attr("x",r.pos.x+r.rect.width+r.padding).attr("y",r.pos.y+n*r.dy+r.rect.height).text(function(t){return t.txt}).style("fill",function(t){return t.c})})};t.draw=function(t,s){i=s;var u=e.select("#"+t);r={width:u.property("style")["width"],height:u.property("style")["height"]};a=u.append("svg").attr("width",r.width).attr("height",r.height);Object.keys(r).forEach(function(t){r[t]=Number(r[t].replace("px",""))});n.legend.pos.x+=r.width;o=Number(i["layout"]["nlayers"]);f.domain([0,c().max]);g.domain([0,Math.abs(c().min)]);var p=e.behavior.zoom().scaleExtent([1,10]).on("zoom",function(){a.attr("transform","translate("+e.event.translate+")scale("+e.event.scale+")")});a=a.on("dblclick",function(){p.scale(1);p.translate([0,0]);a.transition().attr("transform","translate(0,0)scale(1)")}).append("g").call(p).append("g");var h=Array(o);for(var d=0;d<o;d++){h[d]=l(d)}for(d=0;d<o;d++){y(h[d],d,d==0?true:undefined);x(h[d],d,h[d+1])}w()};Object.seal(t);return t});