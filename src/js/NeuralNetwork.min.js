(function(e){require.config({paths:{d3:"https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min"}});define(["d3"],function(t){return e({},t)})})(function(e,t){t.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})};t.selection.prototype.moveToBack=function(){return this.each(function(){var e=this.parentNode.firstChild;if(e){this.parentNode.insertBefore(this,e)}})};var n={neuron:{colors:{input:"#00A000",hidden:"#0000C7",output:"#F6BD00",bias:"#8F686F"},mouseon:{change_radius:2,alpha:.2}},synapse:{colors:{negative:"#00005E",positive:"#FF4B00"},default_width_range:[.5,5],width_range:[.5,5],default_alpha:.7,alpha:.7,mouseon:{width_range:[.5,10],alpha:.1}},variables:{labels_layer0_padding:.03},legend:{pos:{x:150,y:10},rect:{width:10,height:10},dy:20,padding:10}};var r;var a=function(e,t){return Number(Object.keys(e["layout"]["layer_"+t]).length-1)};var i=function(e,t,n){var i=a(e,n);var s=Array(i);for(var o=0;o<i;o++){s[o]={position:{x:(n+.5)*r.width/t,y:(o+.5)*r.height/i},radius:r.height/(i+(i>5?0:5))/4,type:o==i-1?"bias":n==0?"input":"hidden",neuron:o,layer:n};if(n==t-1){s[o]["type"]="output"}}return s};var s=function(e,t,n){var n=e["layout"]["layer_"+t]["neuron_"+n];if(n["nsynapses"]!=0)return n["weights"];return[]};var o=function(e,n){var r=-1e30;var i=1e30;var o;for(var l=0;l<n;l++){for(var u=0;u<a(e,l);u++){o=t.max(s(e,l,u));if(r<o)r=o;o=t.min(s(e,l,u));if(i>o)i=o}}return{min:i,max:r}};var l=function(e,t,n,r,a){var i=s(e,t,n);var o=Array(i.length);for(var l in i){o[l]={layer:t,neuron:n,nextlayer_neuron:l,pos:[r,a[l].position],weight:i[l],type:i[l]<0?"negative":"positive"}}return o};var u=function(e,t){var a=e["variables"];a.push("Bias node");var i=Array(a.length);for(var s in t){i[s]={x:t[s].position.x-n["variables"]["labels_layer0_padding"]*r.width,y:t[s].position.y,text:a[s]+":"}}return i};var p=function(e){e.append("text").text(function(e){return e[1].text}).attr("x",function(e){return e[1].x-this.getComputedTextLength()}).attr("y",function(e){return e[1].y+.25*this.getBBox().height})};var c=function(e,r,a,i,s,o){if(s!==undefined){var l=t.zip(a,u(r,a))}else{var l=t.zip(a,Array(a.length))}var c=e.append("g").attr("id","layer_"+i).attr("class","layer").selectAll("g").data(l).enter().append("g").attr("id",function(e){return"neuron_"+i+""+e[0].neuron});c.append("circle").attr("r",function(e){return e[0].radius}).attr("cx",function(e){return e[0].position.x}).attr("cy",function(e){return e[0].position.y}).style("fill",function(e){return n["neuron"]["colors"][e[0].type]});if(s!==undefined){p(c)}if(o)return;v(e,c)};var h=t.scale.linear();var y=t.scale.linear();var d=t.svg.line().x(function(e){return e.x}).y(function(e){return e.y}).interpolate("linear");var f=function(e,t,r,a,i){for(var s in r){var o=l(t,a,s,r[s].position,i);e.select("g#neuron_"+a+""+s).selectAll("path").data(o).enter().append("path").moveToBack().attr("d",function(e){return d(e.pos)}).attr("stroke",function(e){return n["synapse"]["colors"][e.type]}).attr("stroke-width",function(e){return e.type=="positive"?h(e.weight):y(Math.abs(e.weight))}).attr("stroke-opacity",n["synapse"]["alpha"])}};var v=function(e,r){r.on("mouseover",function(r){h.range(n["synapse"]["mouseon"]["width_range"]);y.range(n["synapse"]["mouseon"]["width_range"]);var a=t.select(this).moveToFront().transition();a.selectAll("path").style("stroke-opacity",1).attr("stroke-width",function(e){return e.type=="positive"?h(e.weight):y(Math.abs(e.weight))});a.selectAll("circle").style("fill-opacity",1).attr("r",function(e){return e[0].radius*n["neuron"]["mouseon"]["change_radius"]});a.selectAll("text").attr("x",function(e){return e[1].x-e[0].radius-this.getComputedTextLength()});var i=e.selectAll("g.layer").selectAll("g").filter(function(e){return!(r[0].neuron==e[0].neuron&&r[0].layer==e[0].layer)}).transition();i.selectAll("circle").filter(function(e){return r[0].layer+1!=e[0].layer}).style("fill-opacity",n["neuron"]["mouseon"]["alpha"]).attr("r",function(e){return e[0].radius});i.selectAll("path").style("stroke-opacity",n["synapse"]["mouseon"]["alpha"]);h.range(n["synapse"]["width_range"]);y.range(n["synapse"]["width_range"])});r.on("mouseout",function(t){var r=e.selectAll("g.layer").selectAll("g").transition();r.selectAll("circle").style("fill-opacity",1).attr("r",function(e){return e[0].radius});r.selectAll("path").style("stroke-opacity",n["synapse"]["alpha"]).attr("stroke-width",function(e){return e.type=="positive"?h(e.weight):y(Math.abs(e.weight))});r.selectAll("text").attr("x",function(e){return e[1].x-this.getComputedTextLength()})})};var g=function(e){var a=[{c:n["synapse"]["colors"]["positive"],txt:"Positive weight"},{c:n["synapse"]["colors"]["negative"],txt:"Negative weight"}];var i=n["legend"];var s=e.append("g").attr("id","legend");s.selectAll("g").data(a).enter().append("g").each(function(e,n){var a=t.select(this);a.append("rect").attr("x",r.width-i.pos.x).attr("y",i.pos.y+n*i.dy).attr("width",i.rect.width).attr("height",i.rect.height).style("fill",function(e){return e.c});a.append("text").attr("x",r.width-i.pos.x+i.rect.width+i.padding).attr("y",i.pos.y+n*i.dy+i.rect.height).text(function(e){return e.txt}).style("fill",function(e){return e.c})})};var w=function(e){vars=e["variables"];vars.push("Bias node");var t=e["layers"];var n=e["synapses"]["synapses"];var r={layer_0:{nneurons:vars.length}};var a;for(var i=0;i<vars.length;i++){a=Number(t[0]["Nodes"]);r["layer_0"]["neuron_"+i]={nsynapses:a,weights:n.slice(i*a,(i+1)*a)}}for(var s=0;s<t.length-1;s++){r["layer_"+(s+1)]={nneurons:Number(t[s]["Nodes"])};a=Number(t[s+1]["Nodes"]);for(var i=0;i<Number(t[s]["Nodes"]);i++){r["layer_"+(s+1)]["neuron_"+i]={nsynapses:a,weights:n.slice(i*a,(i+1)*a)}}}r["layer_"+(s+1)]={nneurons:Number(t[s]["Nodes"])};for(var i=0;i<Number(t[s]["Nodes"]);i++){r["layer_"+(s+1)]["neuron_"+i]={nsynapses:0}}r["nlayers"]=s+2;var o={variables:vars,layout:r};return o};e.draw=function(e,a){var s,l;var u=t.select("#"+e);r={width:u.property("style")["width"],height:u.property("style")["height"]};s=u.append("svg").attr("id","svg_"+e).attr("width",r.width).attr("height",r.height);Object.keys(r).forEach(function(e){r[e]=Number(r[e].replace("px",""))});var p;if("layers"in a&&"synapses"in a){l=w(a);n.synapse.width_range=[5/a["synapses"]["synapses"].length,50/a["synapses"]["synapses"].length];n.synapse.alpha=.9;h.range(n["synapse"]["width_range"]);y.range(n["synapse"]["width_range"]);p=true}else{l=a;n.synapse.width_range=n.synapse.default_width_range;n.synapse.alpha=n.synapse.default_alpha;h.range(n["synapse"]["width_range"]);y.range(n["synapse"]["width_range"]);p=false}var d=Number(l["layout"]["nlayers"]);h.domain([0,o(l,d).max]);y.domain([0,Math.abs(o(l,d).min)]);var v=t.behavior.zoom().scaleExtent([1,20]).on("zoom",function(){s.attr("transform","translate("+t.event.translate+")scale("+t.event.scale+")")});s=s.on("dblclick",function(){v.scale(1);v.translate([0,0]);s.transition().attr("transform","translate(0,0)scale(1)")}).append("g").call(v).append("g");var _=Array(d);for(var x=0;x<d;x++){_[x]=i(l,d,x)}for(x=0;x<d;x++){c(s,l,_[x],x,x==0?true:undefined,p);f(s,l,_[x],x,_[x+1])}g(s)};Object.seal(e);return e});