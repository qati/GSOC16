(function(e){require.config({paths:{d3:"https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min"}});define(["d3"],function(t){return e({},t)})})(function(e,t){t.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})};t.selection.prototype.moveToBack=function(){return this.each(function(){var e=this.parentNode.firstChild;if(e){this.parentNode.insertBefore(this,e)}})};var n={neuron:{colors:{input:"#00A000",hidden:"#0000C7",output:"#F6BD00",bias:"#8F686F"},mouseon:{change_radius:2,alpha:.2}},synapse:{colors:{negative:"#00005E",positive:"#FF4B00"},default_width_rannge:[.5,5],width_range:[.5,5],default_alpha:.7,alpha:.7,mouseon:{width_range:[.5,10],alpha:.1}},variables:{labels_layer0_padding:.03},legend:{pos:{x:750,y:10},rect:{width:10,height:10},dy:20,padding:10}};var r,a,s,i;var o=function(e){return Number(Object.keys(s["layout"]["layer_"+e]).length-1)};var l=function(e){var t=o(e);var n=Array(t);for(var a=0;a<t;a++){n[a]={position:{x:(e+.5)*r.width/i,y:(a+.5)*r.height/t},radius:r.height/(t+(t>5?0:5))/4,type:a==t-1?"bias":e==0?"input":"hidden",neuron:a,layer:e};if(e==i-1){n[a]["type"]="output"}}return n};var u=function(e,t){var t=s["layout"]["layer_"+e]["neuron_"+t];if(t["nsynapses"]!=0)return t["weights"];return[]};var p=function(){var e=-1e30;var n=1e30;var r;for(var a=0;a<i;a++){for(var s=0;s<o(a);s++){r=t.max(u(a,s));if(e<r)e=r;r=t.min(u(a,s));if(n>r)n=r}}return{min:n,max:e}};var c=function(e,t,n,r){var a=u(e,t);var s=Array(a.length);for(var i in a){s[i]={layer:e,neuron:t,nextlayer_neuron:i,pos:[n,r[i].position],weight:a[i],type:a[i]<0?"negative":"positive"}}return s};var h=function(e){var t=s["variables"];t.push("Bias node");var a=Array(t.length);for(var i in e){a[i]={x:e[i].position.x-n["variables"]["labels_layer0_padding"]*r.width,y:e[i].position.y,text:t[i]+":"}}return a};var y=function(e){e.append("text").text(function(e){return e[1].text}).attr("x",function(e){return e[1].x-this.getComputedTextLength()}).attr("y",function(e){return e[1].y+.25*this.getBBox().height})};var d=function(e,r,s,i){if(s!==undefined){var o=t.zip(e,h(e))}else{var o=t.zip(e,Array(e.length))}var l=a.append("g").attr("id","layer_"+r).attr("class","layer").selectAll("g").data(o).enter().append("g").attr("id",function(e){return"neuron_"+r+""+e[0].neuron});l.append("circle").attr("r",function(e){return e[0].radius}).attr("cx",function(e){return e[0].position.x}).attr("cy",function(e){return e[0].position.y}).style("fill",function(e){return n["neuron"]["colors"][e[0].type]});if(s!==undefined){y(l)}if(i)return;_(l)};var f=t.scale.linear().range(n["synapse"]["width_range"]);var g=t.scale.linear().range(n["synapse"]["width_range"]);var v=t.svg.line().x(function(e){return e.x}).y(function(e){return e.y}).interpolate("linear");var w=function(e,t,r){for(var s in e){var i=c(t,s,e[s].position,r);a.select("g#neuron_"+t+""+s).selectAll("path").data(i).enter().append("path").moveToBack().attr("d",function(e){return v(e.pos)}).attr("stroke",function(e){return n["synapse"]["colors"][e.type]}).attr("stroke-width",function(e){return e.type=="positive"?f(e.weight):g(Math.abs(e.weight))}).attr("stroke-opacity",n["synapse"]["alpha"])}};var _=function(e){e.on("mouseover",function(e){f.range(n["synapse"]["mouseon"]["width_range"]);g.range(n["synapse"]["mouseon"]["width_range"]);var r=t.select(this).moveToFront().transition();r.selectAll("path").style("stroke-opacity",1).attr("stroke-width",function(e){return e.type=="positive"?f(e.weight):g(Math.abs(e.weight))});r.selectAll("circle").style("fill-opacity",1).attr("r",function(e){return e[0].radius*n["neuron"]["mouseon"]["change_radius"]});r.selectAll("text").attr("x",function(e){return e[1].x-e[0].radius-this.getComputedTextLength()});var s=a.selectAll("g.layer").selectAll("g").filter(function(t){return!(e[0].neuron==t[0].neuron&&e[0].layer==t[0].layer)}).transition();s.selectAll("circle").filter(function(t){return e[0].layer+1!=t[0].layer}).style("fill-opacity",n["neuron"]["mouseon"]["alpha"]).attr("r",function(e){return e[0].radius});s.selectAll("path").style("stroke-opacity",n["synapse"]["mouseon"]["alpha"]);f.range(n["synapse"]["width_range"]);g.range(n["synapse"]["width_range"])});e.on("mouseout",function(e){var t=a.selectAll("g.layer").selectAll("g").transition();t.selectAll("circle").style("fill-opacity",1).attr("r",function(e){return e[0].radius});t.selectAll("path").style("stroke-opacity",n["synapse"]["alpha"]).attr("stroke-width",function(e){return e.type=="positive"?f(e.weight):g(Math.abs(e.weight))});t.selectAll("text").attr("x",function(e){return e[1].x-this.getComputedTextLength()})})};var x=function(){var e=[{c:n["synapse"]["colors"]["positive"],txt:"Positive weight"},{c:n["synapse"]["colors"]["negative"],txt:"Negative weight"}];var r=n["legend"];var s=a.append("g").attr("id","legend");s.selectAll("g").data(e).enter().append("g").each(function(e,n){var a=t.select(this);a.append("rect").attr("x",r.pos.x).attr("y",r.pos.y+n*r.dy).attr("width",r.rect.width).attr("height",r.rect.height).style("fill",function(e){return e.c});a.append("text").attr("x",r.pos.x+r.rect.width+r.padding).attr("y",r.pos.y+n*r.dy+r.rect.height).text(function(e){return e.txt}).style("fill",function(e){return e.c})})};var m=function(e){vars=e["variables"];vars.push("Bias node");var t=e["layers"];var n=e["synapses"]["synapses"];var r={layer_0:{nneurons:vars.length}};var a;for(var s=0;s<vars.length;s++){a=Number(t[0]["Nodes"]);r["layer_0"]["neuron_"+s]={nsynapses:a,weights:n.slice(s*a,(s+1)*a)}}for(var i=0;i<t.length-1;i++){r["layer_"+(i+1)]={nneurons:Number(t[i]["Nodes"])};a=Number(t[i+1]["Nodes"]);for(var s=0;s<Number(t[i]["Nodes"]);s++){r["layer_"+(i+1)]["neuron_"+s]={nsynapses:a,weights:n.slice(s*a,(s+1)*a)}}}r["layer_"+(i+1)]={nneurons:Number(t[i]["Nodes"])};for(var s=0;s<Number(t[i]["Nodes"]);s++){r["layer_"+(i+1)]["neuron_"+s]={nsynapses:0}}r["nlayers"]=i+2;var o={variables:vars,layout:r};return o};e.draw=function(e,o){s=o;var u=t.select("#"+e);r={width:u.property("style")["width"],height:u.property("style")["height"]};a=u.append("svg").attr("id","svg_"+e).attr("width",r.width).attr("height",r.height);Object.keys(r).forEach(function(e){r[e]=Number(r[e].replace("px",""))});n.legend.pos.x+=r.width;var c;if("layers"in s&&"synapses"in s){n.synapse.width_range=[5/s["synapses"]["synapses"].length,50/s["synapses"]["synapses"].length];n.synapse.alpha=.9;f.range(n["synapse"]["width_range"]);g.range(n["synapse"]["width_range"]);s=m(s);c=true}else{n.synapse.width_range=n.synapse.default_width_rannge;n.synapse.alpha=n.synapse.default_alpha;f.range(n["synapse"]["width_range"]);g.range(n["synapse"]["width_range"]);c=false}i=Number(s["layout"]["nlayers"]);f.domain([0,p().max]);g.domain([0,Math.abs(p().min)]);var h=t.behavior.zoom().scaleExtent([1,20]).on("zoom",function(){a.attr("transform","translate("+t.event.translate+")scale("+t.event.scale+")")});a=a.on("dblclick",function(){h.scale(1);h.translate([0,0]);a.transition().attr("transform","translate(0,0)scale(1)")}).append("g").call(h).append("g");var y=Array(i);for(var v=0;v<i;v++){y[v]=l(v)}for(v=0;v<i;v++){d(y[v],v,v==0?true:undefined,c);w(y[v],v,y[v+1])}x()};Object.seal(e);return e});