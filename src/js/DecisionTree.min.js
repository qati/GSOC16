(function(t){var e="";if(require.s.contexts.hasOwnProperty("_")){e=require.s.contexts._.config.paths["JsMVA"].replace("src/js/JsMVA.min","")}define(["d3"],function(n){return t({},n,e)})})(function(t,e,n){Object.size=function(t){return Object.keys(t).length};var r={margin:{x:20,y:20},node:{padding:10,yspace:40,xspace:20,width:150,height:40,mwidth:150,mheight:60,colors:{focus:"#033A00",closed:"#00A62B",pureBkg:"red",pureSig:"blue"},swidth:"4px"},link:{colors:{default:"#ccc",focus:"#033A00"},width:"4px",focus_width:"8px"},aduration:1500,legend:{size:20,rect_width:100,rect_height:30,rect_fucus_width:115},text:{color:"#DEDEDE",padding:"4px"},buttons:{reset:{width:"36px",height:"36px",alpha:"0.5",img:n+"img/reset.png",background:"white"}}};var i=e.scale.linear().range([r.node.colors.pureBkg,r.node.colors.pureSig]);var o,a,d,l;var s=e.layout.tree();var c=function(){var t=e.svg.diagonal();var n=function(e,n,i){if(i)return t(e);return t({source:{x:e.source.x+r.node.width,y:e.source.y},target:{x:e.target.x+r.node.width,y:e.target.y-r.node.height}})};return n}();var u=function(t){if("children"in t){t._children=t.children;t.children=null}else{t.children=t._children;t._children=null}x(t)};var h=function(t){var e=r.node.height;t.append("text").attr("dy",e*.35).attr("class","label1").attr("dx",r.text.padding).style("fill-opacity",1e-6).style("font-size",1e-6+"px").style("cursor","pointer").style("fill",r.text.color).style("font-weight","bold").text(function(t){return"S/(S+B)="+Number(t.info.purity).toFixed(3)});t.append("text").attr("class","label2").attr("dx",r.text.padding).attr("dy",e*.75).style("fill-opacity",1e-6).style("cursor","pointer").text(function(t){return t.info.IVar!=-1?l[t.info.IVar]+">"+Number(t.info.Cut).toFixed(3):""}).style("font-size",1e-6+"px").style("fill",r.text.color).style("font-weight","bold")};var f=function(t,n){var o=t.enter().append("g").attr("class","nodes").attr("transform",function(t){return"translate("+n.x0+","+n.y0+")"}).style("cursor","pointer");o.filter(function(t){return t.parent}).on("click",u).on("mouseover",p).on("contextmenu",function(t,n){e.event.preventDefault();y(t)}).on("mouseleave",function(t,e){if(t.bigger)y(t,e,1);return p(t,e,1)});o.append("rect").attr("width",1e-6).attr("height",1e-6);h(o);t.transition().duration(r.aduration).attr("transform",function(t){return"translate("+(t.x+r.node.width*.5)+","+(t.y-r.node.height)+")"});t.select("rect").transition().duration(r.aduration).attr("width",r.node.width).attr("height",r.node.height).attr("fill",function(t){return i(Number(t.info.purity))}).style("stroke-width",r.node.swidth).style("stroke",function(t){return t._children?r.node.colors.closed:""});t.selectAll("text").transition().duration(r.aduration).style("font-size",function(t){var e="S/(S+B)="+Number(t.info.purity).toFixed(3);var n=t.info.IVar!=-1?l[t.info.IVar]+">"+Number(t.info.Cut).toFixed(3):"";t.font_size=1.5*(r.node.width-2*Number(r.node.swidth.replace("px","")))/Math.max(e.length,n.length);return t.font_size+"px"}).attr("dx",r.text.padding).attr("dy",function(t){return(e.select(this).attr("class")=="label1"?r.node.height*.35:r.node.height*.75)+"px"}).style("fill-opacity",1);var a=t.exit().transition().duration(r.aduration).attr("transform",function(t){return"translate("+(n.x+r.node.width)+","+n.y+")"}).remove();a.select("rect").attr("width",1e-6).attr("height",1e-6);a.selectAll("text").style("font-size",1e-6+"px").style("fill-opacity",1e-6)};var g=function(t,e){t.enter().insert("path","g").attr("class","link").attr("d",function(t,n){var r={x:e.x0,y:e.y0};return c({source:r,target:r},n,1)});t.transition().duration(r.aduration).attr("d",c).style("fill","none").style("stroke",r.link.colors.default).style("stroke-width",r.link.width).attr("id",function(t){return"link"+t.target.id});t.exit().transition().duration(r.aduration).attr("d",function(t,n){var i={x:e.x+r.node.width,y:e.y};return c({source:i,target:i},n,1)}).remove()};var p=function(t,e,n){a.selectAll("path.link").filter(function(e){return e.target.id==t.id}).style("stroke-width",n?r.link.width:r.link.focus_width).style("stroke",n?r.link.colors.default:r.link.colors.focus);a.selectAll("g.nodes rect").filter(function(e){return e.id==t.id}).style("stroke-width",r.node.swidth).style("stroke",function(t){return n?t._children?r.node.colors.closed:i(t.info.purity):r.node.colors.focus});if(t.parent)p(t.parent,e,n)};var y=function(t,n,i){var o=i?r.node.width:2*r.node.width,d=i?r.node.height:1.5*r.node.height;console.log("anim height:"+String(d));a.selectAll("g.nodes rect").filter(function(e){e.bigger=i?false:true;return e.id==t.id}).transition().duration(r.aduration/2).attr("width",o+"px").attr("height",d+"px");a.selectAll("g.nodes text").filter(function(e){return e.id==t.id}).transition().duration(r.aduration/2).style("font-size",function(t){return(i?t.font_size:2*t.font_size)+"px"}).attr("dx",i?r.text.padding:2*Number(r.text.padding.replace("px",""))+"px").attr("dy",function(){return(e.select(this).attr("class")=="label1"?d*.35:d*.75)+"px"});if(t.parent)y(t.parent,n,i)};var x=function(t,e){b();var n=s.nodes(d),i=s.links(n);var l=0;n.forEach(function(t){if(l<Number(t.depth))l=Number(t.depth)});n.forEach(function(t){t.y=t.depth*o.height/l});if(!"x0"in t||!("y0"in t)){t.x0=n[0].x+r.node.width*.5;t.y0=n[0].y-r.node.height}var c=a.selectAll("g.nodes").data(n,function(t,e){return t.id||(t.id=e)});f(c,t);var u=a.selectAll("path.link").data(i,function(t){return t.target.id});g(u,t);a.transition().duration(r.aduration).attr("transform","translate("+-r.node.width+", "+r.node.height+")");if(e!==undefined&&e==true)return;n.forEach(function(t){t.x0=t.x+r.node.width;t.y0=t.y})};var v=function(t){if(t.length!==undefined){var e=0;for(var n in t){e+=v(t[n])}return e}if(!("children"in t)||t["children"].length==0)return 0;return 1+v(t["children"])};var w=function(t){var e=Array();for(var n in t){if(e.indexOf(Math.round(t[n].x))==-1){e.push(Math.round(t[n].x))}}return e.length+1};var m=function(t){var e=1e6,n=-1e6;var r;for(var i in t){r=Number(t[i].info.purity);if(r<e)e=r;if(r>n)n=r}return[e,n]};var b=function(t){var e=s.nodes(d);var n;for(var a in e){if(!e[a].parent){n=e[a];break}}var l=v(n);r.node.height=o.height/(l+1)-r.node.yspace;if(r.node.height>r.node.mheight)r.node.height=r.node.mheight;var c=0;while(l!=0){if(!(l%4))c++;l/=4}r.node.width=o.width/(w(e)+1-c)-r.node.xspace;if(r.node.width>r.node.mwidth)r.node.height=r.node.mwidth;s.size([o.width,o.height]);i.domain(m(e))};var k=function(t){var n=[{text:"Pure Backg.",id:"label1",color:i(i.domain()[0]),x:5,y:5},{text:"Pure Signal",id:"label2",color:i(i.domain()[1]),x:5,y:40}];var o=t.append("g").attr("transform","translate(5,5)");var a=o.selectAll("g").data(n,function(t){return t.id}).enter().append("g").style("cursor","pointer").attr("transform",function(t){return"translate("+t.x+","+t.y+")"});a.on("mouseover",function(t){e.select("#"+t.id).style("font-weight","bold");e.select("#"+t.id+"_rect").attr("width",r.legend.rect_fucus_width)});a.on("mouseout",function(t){e.select("#"+t.id).style("font-weight","normal");e.select("#"+t.id+"_rect").attr("width",r.legend.rect_width)});a.append("rect").attr("id",function(t){return t.id+"_rect"}).attr("width",r.legend.rect_width).attr("height",r.legend.rect_height).attr("fill",function(t){return t.color});a.append("text").attr("id",function(t){return t.id}).attr("x",function(t){return 5}).attr("y",function(t){return 20}).text(function(t){return t.text}).style("fill",r.text.color)};var _=function(t){if("_children"in t&&t.children==null){t.children=t._children;t._children=null}if("children"in t&&t.children!=null){for(var e in t.children){_(t.children[e])}}};var z=function(t){var e=[];var n=[];n.push(t);while(n.length>0){var r=n.shift();if("_children"in r&&r._children!=null){e.push(r)}if(r.children!=null){for(var i=0;i<r.children.length;i++){n.push(r.children[i])}}}return e.length>0?e:t};t.draw=function(t,n){var i=e.select("#"+t);d=n["tree"];l=n["variables"];if(Object.size(d)==0){i.innerHTML="<b style='color:red'>Tree empty...</b>";return}o={width:i.property("style")["width"],height:i.property("style")["height"]};a=i.append("svg").attr("width",o.width).attr("height",o.height);var s=a;Object.keys(o).forEach(function(t){o[t]=Number(o[t].replace("px",""));o[t]-=t=="width"?2*r.margin.x+r.node.width:2*r.margin.y+r.node.height});b(1);var c=e.behavior.zoom().scaleExtent([1,10]).on("zoom",function(){a.attr("transform","translate("+-r.node.width+", "+r.node.height+")translate("+e.event.translate+")scale("+e.event.scale+")")});a=a.on("dblclick",function(){c.scale(1);c.translate([0,0]);a.transition().attr("transform","translate("+-r.node.width+", "+r.node.height+")")}).append("g").call(c).append("g").attr("transform","translate("+-r.node.width+", "+r.node.height+")");k(s);x(d);i.append("button").style("position","relative").style("top","-"+r.buttons.reset.height).style("width",r.buttons.reset.width).style("height",r.buttons.reset.height).style("opacity",r.buttons.reset.alpha).style("background",r.buttons.reset.background).style("background-size","contain").style("background-image","url("+r.buttons.reset.img+")").style("cursor","pointer").style("border","none").on("mouseover",function(){e.select(this).style("opacity","1")}).on("mouseout",function(){e.select(this).style("opacity",r.buttons.reset.alpha)}).on("click",function(){c.scale(1);c.translate([0,0]);a.transition().attr("transform","translate("+-r.node.width+", "+r.node.height+")");var t=z(d);for(var e=0;e<t.length;e++){_(t[e]);x(t[e],true)}})};Object.seal(t);return t});