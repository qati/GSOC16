(function(t){require.config({paths:{d3:"https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min"}});define(["d3"],function(e){return t({},e)})})(function(t,e){Object.size=function(t){return Object.keys(t).length};var n={margin:{x:20,y:20},node:{padding:10,yspace:40,xspace:20,width:150,height:40,mwidth:150,mheight:60,colors:{focus:"#033A00",closed:"#00A62B",pureBkg:"red",pureSig:"blue"},swidth:"4px"},link:{colors:{"default":"#ccc",focus:"#033A00"},width:"4px",focus_width:"8px"},aduration:1500,legend:{size:20,rect_width:100,rect_height:30,rect_fucus_width:115},text:{color:"#DEDEDE",padding:"4px"}};var r=e.scale.linear().range([n.node.colors.pureBkg,n.node.colors.pureSig]);var i,o,a,d;var l=e.layout.tree();var c=function(){var t=e.svg.diagonal();var r=function(e,r,i){if(i)return t(e);return t({source:{x:e.source.x+n.node.width,y:e.source.y},target:{x:e.target.x+n.node.width,y:e.target.y-n.node.height}})};return r}();var s=function(t){if("children"in t){t._children=t.children;t.children=null}else{t.children=t._children;t._children=null}p(t)};var u=function(t){t.append("text").attr("dy",n.node.height*.35+"px").attr("class","label1").attr("dx",n.text.padding).style("fill-opacity",1e-6).style("font-size",1e-6+"px").style("cursor","pointer").style("fill",n.text.color).style("font-weight","bold").text(function(t){return"S/(S+B)="+Number(t.info.purity).toFixed(3)});console.log(n.text.padding);t.append("text").attr("class","label2").attr("dx",n.text.padding).attr("dy",n.node.height*.75+"px").style("fill-opacity",1e-6).style("cursor","pointer").text(function(t){return t.info.IVar!=-1?d[t.info.IVar]+">"+Number(t.info.Cut).toFixed(3):""}).style("font-size",1e-6+"px").style("fill",n.text.color).style("font-weight","bold")};var h=function(t,i){var o=t.enter().append("g").attr("class","nodes").attr("transform",function(t){return"translate("+i.x0+","+i.y0+")"}).style("cursor","pointer");o.filter(function(t){return t.parent}).on("click",s).on("mouseover",g).on("mouseout",function(t,e){return g(t,e,1)});o.append("rect").attr("width",1e-6).attr("height",1e-6);u(o);t.transition().duration(n.aduration).attr("transform",function(t){return"translate("+(t.x+n.node.width*.5)+","+(t.y-n.node.height)+")"});t.select("rect").transition().duration(n.aduration).attr("width",n.node.width).attr("height",n.node.height).attr("fill",function(t){return r(Number(t.info.purity))}).style("stroke-width",n.node.swidth).style("stroke",function(t){return t._children?n.node.colors.closed:""});t.selectAll("text").transition().duration(n.aduration).style("font-size",function(t){var e="S/(S+B)="+Number(t.info.purity).toFixed(3);var r=t.info.IVar!=-1?d[t.info.IVar]+">"+Number(t.info.Cut).toFixed(3):"";t.font_size=1.5*(n.node.width-2*Number(n.node.swidth.replace("px","")))/Math.max(e.length,r.length);return t.font_size+"px"}).attr("dx",n.text.padding).attr("dy",function(t){return(e.select(this).attr("class")=="label1"?n.node.height*.35:n.node.height*.75)+"px"}).style("fill-opacity",1);var a=t.exit().transition().duration(n.aduration).attr("transform",function(t){return"translate("+(i.x+n.node.width)+","+i.y+")"}).remove();a.select("rect").attr("width",1e-6).attr("height",1e-6);a.selectAll("text").style("font-size",1e-6+"px").style("fill-opacity",1e-6)};var f=function(t,e){t.enter().insert("path","g").attr("class","link").attr("d",function(t,n){var r={x:e.x0,y:e.y0};return c({source:r,target:r},n,1)});t.transition().duration(n.aduration).attr("d",c).style("fill","none").style("stroke",n.link.colors.default).style("stroke-width",n.link.width).attr("id",function(t){return"link"+t.target.id});t.exit().transition().duration(n.aduration).attr("d",function(t,r){var i={x:e.x+n.node.width,y:e.y};return c({source:i,target:i},r,1)}).remove()};var g=function(t,e,i){o.selectAll("path.link").filter(function(e){return e.target.id==t.id}).style("stroke-width",i?n.link.width:n.link.focus_width).style("stroke",i?n.link.colors.default:n.link.colors.focus);o.selectAll("g.nodes rect").filter(function(e){return e.id==t.id}).style("stroke-width",n.node.swidth).style("stroke",function(t){return i?t._children?n.node.colors.closed:r(t.info.purity):n.node.colors.focus}).style("width",function(t){return(i?n.node.width:2*n.node.width)+"px"}).style("width",function(t){return(i?n.node.height:2*n.node.height)+"px"});o.selectAll("g.nodes text").filter(function(e){return e.id==t.id}).attr("font-size",function(t){return i?t.font_size:2*Number(t.font_size.replace("px",""))+"px"});if(t.parent)g(t.parent,e,i)};var p=function(t){v();var e=l.nodes(a),r=l.links(e);var d=0;e.forEach(function(t){if(d<Number(t.depth))d=Number(t.depth)});e.forEach(function(t){t.y=t.depth*i.height/d});if(!"x0"in t||!("y0"in t)){t.x0=e[0].x+n.node.width*.5;t.y0=e[0].y-n.node.height}var c=o.selectAll("g.nodes").data(e,function(t,e){return t.id||(t.id=e)});h(c,t);var s=o.selectAll("path.link").data(r,function(t){return t.target.id});f(s,t);o.transition().duration(n.aduration).attr("transform","translate("+-n.node.width+", "+n.node.height+")");e.forEach(function(t){t.x0=t.x+n.node.width;t.y0=t.y})};var y=function(t){if(t.length!==undefined){var e=0;for(var n in t){e+=y(t[n])}return e}if(!("children"in t)||t["children"].length==0)return 0;return 1+y(t["children"])};var x=function(t){var e=Array();for(var n in t){if(e.indexOf(Math.round(t[n].x))==-1){e.push(Math.round(t[n].x))}}return e.length+1};var w=function(t){var e=1e6,n=-1e6;var r;for(var i in t){r=Number(t[i].info.purity);if(r<e)e=r;if(r>n)n=r}return[e,n]};var v=function(t){var e=l.nodes(a);var o;for(var d in e){if(!e[d].parent){o=e[d];break}}var c=y(o);n.node.height=i.height/(c+1)-n.node.yspace;if(n.node.height>n.node.mheight)n.node.height=n.node.mheight;var s=0;while(c!=0){if(!(c%4))s++;c/=4}n.node.width=i.width/(x(e)+1-s)-n.node.xspace;if(n.node.width>n.node.mwidth)n.node.height=n.node.mwidth;l.size([i.width,i.height]);r.domain(w(e))};var m=function(t){var i=[{text:"Pure Backg.",id:"label1",color:r(r.domain()[0]),x:5,y:5},{text:"Pure Signal",id:"label2",color:r(r.domain()[1]),x:5,y:40}];var o=t.append("g").attr("transform","translate(5,5)");var a=o.selectAll("g").data(i,function(t){return t.id}).enter().append("g").style("cursor","pointer").attr("transform",function(t){return"translate("+t.x+","+t.y+")"});a.on("mouseover",function(t){e.select("#"+t.id).style("font-weight","bold");e.select("#"+t.id+"_rect").attr("width",n.legend.rect_fucus_width)});a.on("mouseout",function(t){e.select("#"+t.id).style("font-weight","normal");e.select("#"+t.id+"_rect").attr("width",n.legend.rect_width)});a.append("rect").attr("id",function(t){return t.id+"_rect"}).attr("width",n.legend.rect_width).attr("height",n.legend.rect_height).attr("fill",function(t){return t.color});a.append("text").attr("id",function(t){return t.id}).attr("x",function(t){return 5}).attr("y",function(t){return 20}).text(function(t){return t.text}).style("fill",n.text.color)};t.draw=function(t,r){var l=e.select("#"+t);a=r["tree"];d=r["variables"];if(Object.size(a)==0){l.innerHTML="<b style='color:red;'>Tree empty...</b>";return}i={width:l.property("style")["width"],height:l.property("style")["height"]};o=l.append("svg").attr("width",i.width).attr("height",i.height);var c=o;Object.keys(i).forEach(function(t){i[t]=Number(i[t].replace("px",""));i[t]-=t=="width"?2*n.margin.x+n.node.width:2*n.margin.y+n.node.height});v(1);var s=e.behavior.zoom().scaleExtent([1,10]).on("zoom",function(){o.attr("transform","translate("+-n.node.width+", "+n.node.height+")translate("+e.event.translate+")scale("+e.event.scale+")")});o=o.on("dblclick",function(){s.scale(1);s.translate([0,0]);o.transition().attr("transform","translate("+-n.node.width+", "+n.node.height+")")}).append("g").call(s).append("g").attr("transform","translate("+-n.node.width+", "+n.node.height+")");m(c);p(a)};Object.seal(t);return t});